{% extends "layout.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='behavioral.css') }}">

<h2 class="text-white mb-4">Behavioral Intelligence</h2>

<!-- Row 1: Cluster Scatter (Duration vs Events) & Anomaly List -->
<div class="row g-4 mb-4">
    <!-- Cluster Scatter Plot -->
    <div class="col-md-8">
        <div class="card bg-dark border-secondary text-white h-100">
            <div class="card-header border-secondary">
                Session Clusters: Duration vs Events
                <span class="badge bg-info float-end" id="silhouetteScore">Silhouette: --</span>
            </div>
            <div class="card-body">
                <div style="height: 400px; position: relative;">
                    <canvas id="clusterScatterChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Anomaly List -->
    <div class="col-md-4">
        <div class="card bg-dark border-secondary text-white h-100">
            <div class="card-header border-secondary text-warning">
                <i class="fas fa-exclamation-triangle me-2"></i>Detected Anomalies
            </div>
            <div class="card-body overflow-auto" style="max-height: 400px;">
                <table class="table table-dark table-sm table-hover" id="anomalyTable">
                    <thead>
                        <tr>
                            <th>Session ID</th>
                            <th>IP Address</th>
                            <th>Cluster</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Row 2: Cluster Profile Table & Behavior Heatmap -->
<div class="row g-4 mb-4">
    <div class="col-md-6">
        <div class="card bg-dark border-secondary text-white h-100">
            <div class="card-header border-secondary">
                <i class="fas fa-table me-2"></i>Cluster Profile Table (Average Behaviors)
            </div>
            <div class="card-body overflow-auto">
                <table class="table table-dark table-sm table-hover" id="clusterProfileTable">
                    <thead>
                        <tr>
                            <th>Cluster</th>
                            <th>Duration (avg)</th>
                            <th>Events (avg)</th>
                            <th>Bytes (avg)</th>
                            <th>Velocity (avg)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card bg-dark border-secondary text-white h-100">
            <div class="card-header border-secondary">
                <i class="fas fa-th me-2"></i>Behavior Heatmap (Features vs Clusters)
            </div>
            <div class="card-body">
                <div style="height: 350px; position: relative;">
                    <canvas id="behaviorHeatmapChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Row 3: Stability Plots (Static Image) -->
<div class="row g-4">
    <div class="col-md-12">
        <div class="card bg-dark border-secondary text-white h-100">
            <div class="card-header border-secondary">
                <i class="fas fa-image me-2"></i>Cluster Stability Analysis
            </div>
            <div class="card-body text-center">
                <img id="stabilityPlotImg" src="" alt="Stability Plot" class="img-fluid rounded" style="max-height: 400px; display: none;">
                <p id="stabilityLoading" class="text-muted">Loading plot...</p>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='behavioral.js') }}"></script>
{% endblock %}
